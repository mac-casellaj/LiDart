<!DOCTYPE html>
<html>
<body>

<!-- title -->
<h1>LiDart</h1> 

<!--Creating the buttons for scanning and calibrating-->
<button onclick="scanFunction()">Scan</button>
<button onclick="calibrateFunction()">Calibrate</button>
<p></p>

<!--Arrow Keys as input on the webpage-->
<button ontouchstart="moveUp()" , onclick="moveUp()">Up</button>
<button ontouchstart="moveDown()" , onclick="moveDown()">Down</button>
<button ontouchstart="moveRight()" , onclick="moveRight()">Right</button>
<button ontouchstart="moveLeft()" , onclick="moveLeft()">Left</button>

<!--Keyboard input-->
<script>
    // communication with the websocket
    let socket = new WebSocket(`${(location.protocol == "https:") ? "wss" : "ws"}://${location.host}/ws`);
    socket.onopen = function(e) {
        console.log("Connection established");
        console.log("Sending to server");
    };
  
    socket.onclose = function(event) {
        if (event.wasClean) {
            console.log(`Connection closed, code=${event.code} reason=${event.reason}`);
        } else {
            console.log('Connection died');
        }
    };
  
    socket.onerror = function(error) {
        console.log(error)
    };
  
    // Scripts for the buttons
    function scanFunction() {
        console.log("Scan Button pressed");
        socket.send("Scan Button pressed");
    }

    function calibrateFunction() {
        console.log("Calibrate button pressed");
        socket.send("Calibrate button pressed");
    }
    
    let down_down = false;
    let up_down = false;
    let left_down = false;
    let right_down = false;

    function sendToMotor() {
        if(down_down) {
            socket.send("BACK");
        } else if(up_down) {
            socket.send("FORWARD");
        } else if(left_down) {
            socket.send("LEFT");
        } else if(right_down) {
            socket.send("RIGHT");
        } else {
            socket.send("STOP");
        }
    }

    window.addEventListener("keydown", function(event) {
        if (event.code === "ArrowDown") down_down = true;
        if (event.code === "ArrowUp") up_down = true;
        if (event.code === "ArrowLeft") left_down = true;
        if (event.code === "ArrowRight") right_down = true;

        sendToMotor();
    });

    window.addEventListener("keyup", function(event) {
        if (event.code === "ArrowDown") down_down = false;
        if (event.code === "ArrowUp") up_down = false;
        if (event.code === "ArrowLeft") left_down = false;
        if (event.code === "ArrowRight") right_down = false;

        sendToMotor();
    });
</script>

</body>
</html>
